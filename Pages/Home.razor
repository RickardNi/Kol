@page "/"

@inject IJSRuntime JS

<PageTitle>Kol</PageTitle>

<div class="health-tracker">
    <div class="player topPlayer">
        <div class="tap-zone top @(topPlayerTopPressed ? "pressed" : null)"
             @onpointerdown="() => SetPressed(true, true, true)"
             @onpointerup="() => SetPressed(true, true, false)"
             @onpointerleave="() => SetPressed(true, true, false)"
             @onclick="() => IncreaseHealth(true)"></div>
        <span class="health">@topPlayerHealth</span>
        <div class="tap-zone bottom @(topPlayerBottomPressed ? "pressed" : null)"
             @onpointerdown="() => SetPressed(true, false, true)"
             @onpointerup="() => SetPressed(true, false, false)"
             @onpointerleave="() => SetPressed(true, false, false)"
             @onclick="() => DecreaseHealth(true)"></div>
    </div>
    <div class="player bottomPlayer">
        <div class="tap-zone top @(bottomPlayerTopPressed ? "pressed" : null)"
             @onpointerdown="() => SetPressed(false, true, true)"
             @onpointerup="() => SetPressed(false, true, false)"
             @onpointerleave="() => SetPressed(false, true, false)"
             @onclick="() => IncreaseHealth(false)"></div>
        <span class="health">@bottomPlayerHealth</span>
        <div class="tap-zone bottom @(bottomPlayerBottomPressed ? "pressed" : null)"
             @onpointerdown="() => SetPressed(false, false, true)"
             @onpointerup="() => SetPressed(false, false, false)"
             @onpointerleave="() => SetPressed(false, false, false)"
             @onclick="() => DecreaseHealth(false)"></div>
    </div>
</div>

@code {
    private const int StartHealth = 20;
    private const int VibrationDuration = 30;
    private int topPlayerHealth = StartHealth;
    private int bottomPlayerHealth = StartHealth;

    private bool topPlayerTopPressed = false;
    private bool topPlayerBottomPressed = false;
    private bool bottomPlayerTopPressed = false;
    private bool bottomPlayerBottomPressed = false;

    private async void SetPressed(bool isTopPlayer, bool isTop, bool pressed)
    {
        if (isTopPlayer)
        {
            if (isTop) topPlayerTopPressed = pressed;
            else topPlayerBottomPressed = pressed;
        }
        else
        {
            if (isTop) bottomPlayerTopPressed = pressed;
            else bottomPlayerBottomPressed = pressed;
        }
        if (pressed)
        {
            await JS.InvokeVoidAsync("vibrate", VibrationDuration);
        }
    }

    private void IncreaseHealth(bool isTopPlayer)
    {
        if (isTopPlayer)
            topPlayerHealth++;
        else
            bottomPlayerHealth++;
    }

    private void DecreaseHealth(bool isTopPlayer)
    {
        if (isTopPlayer)
            topPlayerHealth--;
        else
            bottomPlayerHealth--;
    }
}

<script>
  window.vibrate = function (duration) {
    if (navigator.vibrate) {
      navigator.vibrate(duration);
    }
  }
</script>

<style>
.health-tracker {
    display: flex;
    flex-direction: column;
    height: 100vh;
    margin: 0;
    padding: 0;
}
.player {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    position: relative;
    touch-action: manipulation;
    -webkit-tap-highlight-color: transparent;
}
.topPlayer {
    background: #000;
    color: #e74c6f;
    transform: rotate(180deg);
}
.bottomPlayer {
    background: #000;
    color: #4c6fe7;
}
.health {
    font-size: 8rem;
    font-weight: bold;
    user-select: none;
    z-index: 2;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    pointer-events: none;
}
.tap-zone {
    width: 100%;
    height: 50%;
    position: absolute;
    left: 0;
    z-index: 1;
    background: transparent;
    transition: background 0.1s;
}
.tap-zone.top {
    top: 0;
    border-bottom: 1px solid rgba(255,255,255,0.05);
}
.tap-zone.bottom {
    bottom: 0;
    border-top: 1px solid rgba(255,255,255,0.05);
}
.tap-zone.pressed {
    background: rgba(255,255,255,0.08);
}
body, html {
    height: 100%;
    margin: 0;
    padding: 0;
    background: #000;
    overflow: hidden;
    touch-action: none;
}
</style>
