<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="Kol" />
    <meta name="theme-color" content="#000000" />
    <meta name="msapplication-navbutton-color" content="#000000" />
    <meta name="apple-touch-fullscreen" content="yes" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="msapplication-tap-highlight" content="no" />
    <!-- Additional meta tags for better fullscreen support -->
    <meta name="theme-color" media="(prefers-color-scheme: light)" content="#000000" />
    <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000000" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <title>Kol</title>
    <base href="/" />
    <link rel="stylesheet" href="css/app.css" />
    <link rel="icon" type="image/png" href="favicon.png" />
    <link href="manifest.webmanifest" rel="manifest" />
    <link rel="apple-touch-icon" sizes="512x512" href="icon-512.png" />
    <link rel="apple-touch-icon" sizes="192x192" href="icon-192.png" />
</head>

<body style="background: #000;">
    <div id="app">
        <svg class="loading-progress">
            <circle r="40%" cx="50%" cy="50%" />
            <circle r="40%" cx="50%" cy="50%" />
        </svg>
    </div>

    <div id="blazor-error-ui">
        An unhandled error has occurred.
        <a href="." class="reload">Reload</a>
        <span class="dismiss">ðŸ—™</span>
    </div>
    <script src="_framework/blazor.webassembly.js"></script>
    <script src="js/fullscreen.js"></script>
    <script src="js/wakeLock.js"></script>
    <script src="js/gameLogic.js"></script>
    <script>
      // Simple build number function
      window.getBuildNumber = function() {
        const buildNumber = '${BUILD_NUMBER}';
        // If the template variable wasn't replaced (development), return 'dev'
        return buildNumber.startsWith('${') ? 'dev' : buildNumber;
      };

      // Service worker registration with update detection
      if ('serviceWorker' in navigator) {
        // Only register service worker in production
        if (location.hostname !== 'localhost' && location.hostname !== '127.0.0.1') {
          window.addEventListener('load', () => {
              navigator.serviceWorker.register('/service-worker.js')
                  .then(registration => {
                      console.log('Service Worker registered successfully');
                      
                      // Check for updates
                      registration.addEventListener('updatefound', () => {
                          const newWorker = registration.installing;
                          console.log('New service worker found, installing...');
                          
                          newWorker.addEventListener('statechange', () => {
                              if (newWorker.state === 'installed') {
                                  if (navigator.serviceWorker.controller) {
                                      // New update available
                                      console.log('New version available! Refresh to update.');
                                      // You can show a toast/notification here
                                      // For automatic update, uncomment the next line:
                                      // newWorker.postMessage({ type: 'SKIP_WAITING' });
                                  } else {
                                      // First time installation
                                      console.log('Content is now available offline!');
                                  }
                              }
                          });
                      });
                      
                      // Listen for controlling service worker changes
                      navigator.serviceWorker.addEventListener('controllerchange', () => {
                          console.log('Controller changed, reloading page...');
                          window.location.reload();
                      });
                  })
                  .catch(error => {
                      console.error('Service Worker registration failed:', error);
                  });
          });
        } else {
          console.log('Development mode - skipping service worker registration');
        }
      }
    </script>
</body>

</html>